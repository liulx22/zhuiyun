<!doctype html>
<html class="feedback">
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<meta name="misapplication-tap-highlight" content="no" />
		<meta name="HandheldFriendly" content="true" />  
		<meta name="MobileOptimized" content="320" /> 
		<link href="./resource/mui/css/mui.css" rel="stylesheet" />
		<link href="./resource/mui/css/mui.picker.min.css" rel="stylesheet" /> 
		<link rel="stylesheet" type="text/css" href="resource/css/fangh/app.css" />
		<link rel="stylesheet" type="text/css" href="resource/css/fangh/iconfont.css" />  
		<link rel="stylesheet" type="text/css" href="resource/css/fangh/feedback-page.css" />  
		<link rel="stylesheet" href="resource/css/fangh/font-awesome.min.css">  
		<script type="text/javascript" src="resource/css/fangh/js/common.js"></script>  
		<script type="text/javascript" src="resource/css/fangh/js/utitls.js"></script>  
		<style>
			#fileBox{margin:1rem 0;}
			#fileBox label{display:block;float:left;height:50px;width:50px;background:url(images/++.png) no-repeat center;}
			#fileBox .file-btn{height:50px;width:50px;margin:0 .5rem .5rem 0;opacity:0;}
			#fileBox .review-box{display:block;float:left;}
			#fileBox .review-box img{height:50px;width:50px;margin:0 .5rem .5rem 0;}
			#fileBox .prev-item{position:relative;display:inline-block;}
			#fileBox .prev-item .closebtn{position:absolute;right: -1px;top: -4px;display: block;height: 14px;width: 14px;color: #fff;font-size: 16px;line-height:14px; text-align: center;background: red;border-radius: 10px;}
		</style>
		<style type="text/css">
		    .del {  
		        position: absolute;  
		        top:1px;  
		        right: 1px;   
		        display: block;        
		     line-height: 1;  
		        cursor: pointer;  
		        color:#fff;  
		        }  
		  
		    .del:hover {  
		        color:#ff3333;  
		    }  
		</style>  
		<style>  
		    .table-view {  
		        position: relative;  
		        margin-top: 0;  
		        margin-bottom: 0;  
		        padding-left: 0;  
		        list-style: none;  
		        background-color: #f5f5f5;  
		    }  
		      
		    .table-view-cell {  
		        position: relative;  
		        overflow: hidden;  
		        padding: 0px 15px;  
		        -webkit-touch-callout: none;  
		        margin-bottom: 1px;  
		    }  
		      
		    .table-view-cell:after {  
		        position: absolute;  
		        right: 0;  
		        bottom: 0;  
		        left: 0px;  
		        height: 1px;  
		        content: '';  
		        -webkit-transform: scaleY(.5);  
		        transform: scaleY(.5);  
		        background-color: #c8c7cc;  
		    }  
		      
		    .table-view-cell>a:not(.btn) {  
		        position: relative;  
		        display: block;  
		        overflow: hidden;  
		        margin: -0px -15px;  
		        padding: inherit;  
		        white-space: nowrap;  
		        text-overflow: ellipsis;  
		        color: inherit;  
		        background-color: #75b9f4;  
		        height: 40px;  
		        line-height: 40px;  
		    }  
		      
		    .navigate-right:after  
		    {  
		        font-family: Muiicons;  
		        font-size: inherit;  
		        line-height: 1;  
		        position: absolute;  
		        top: 50%;  
		        display: inline-block;  
		        -webkit-transform: translateY(-50%);  
		        transform: translateY(-50%);  
		        text-decoration: none;  
		        color: #666;  
		        -webkit-font-smoothing: antialiased;  
		    }  
		      
		    .table-view-cell.collapse .collapse-content {  
		        position: relative;  
		        display: none;  
		        overflow: hidden;  
		        margin: 0px -15px 0px;  
		        padding: 0px 0px !important;  
		        -webkit-transition: height .35s ease;  
		        -o-transition: height .35s ease;  
		        transition: height .35s ease;  
		        background-color: transparent;  
		    }  
		    .image-item{  
		        position: relative;  
		    }  
		    .image-item .info{  
		        position: absolute;  
		        top:0px;  
		        left:4px;  
		        color: #ff9900;  
		        font-size: 12px;                          
		          
		    }  
		</style>  
	</head>
	<body>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<h1 class="mui-title">上传养护记录</h1>
		</header>
		<div class="mui-content">
			<div class="mui-input-row" style="margin: 5% 3% 5% 3%;">
				<textarea id="textarea" rows="5"  placeholder="请填写备注:"></textarea>
			</div>
			<form class="mui-input-group" style="margin: 0 3% 0 3%;">
				<div class="mui-input-row" >
					<label>选择时间：</label>
					<input type="text"  id="dateSelect" class="mui-input-clear" readonly="readonly">
				</div>
			</form>
			<div style="margin-top: 3%;margin-left: 7%;">选择图片：</div>  
			    <input type="hidden" id="ckjl.id" name="ckjl.id" value="429" >  
			            <div class="collapse-content" style="margin: 0 3% 0 3%;">  
			                <form>  
			                    <label class="row-label"></label>  
			                    <div id='F_CKJLBS' class="row image-list">  
			                        <div class="image-item " id="F_CKJLB" onclick="showActionSheet(this);"></div>  
								</div>  
			                </form>  
						</div>  
			<div style="margin-top: 3%;margin-left: 7%;">选择视频：</div> 
			 <form class="mui-input-group" style="margin: 5% 3% 0 3%;">
			 	<div class="mui-input-row">
			 		<label id="video" type="button">选择视频：</label>
			 		<label style="float: left;margin-left: -15px;" type="button" onclick="cleanHistory()">删除视频</label>
			 	</div>
			 	<div class="mui-input-row" style="width: auto;height: 3.5rem;">
			 		<ul id="history" class="dlist" style="text-align:left;height: 30px;">
			 			<li id="empty" class="ditem-empty">无视频</li>
			 		</ul>
			 	</div>
			 	<div id="outpos"/></div>
			 	<div id="output">
			 	</div>
			 </form>
			<div class="mui-content-padded">
				<button type="button" class="mui-btn mui-btn-block mui-btn-primary">确认</button>
			</div>
		</div>
		<script src="resource/mui/js/mui.min.js"></script>
		<script src="resource/jquery-3.2.1.js"></script>  
		<script src="resource/mui/js/mui.picker.min.js"></script>
		<script type="text/javascript">
			mui.init()
			$(function(){
				$("#output").hide();
			})
			mui(document.body).on('tap', '.mui-btn', function(e) {
			    mui(this).button('loading');
			    setTimeout(function() {
			        mui(this).button('reset');
			    }.bind(this), 2000);
			});
			var oldBack = mui.back;
			mui.back=function(e){
			    mui.confirm("尚未提交，返回后将会丢失填写内容物，是否返回？","返回确认",['返回','取消'],function(e){
			        if(e.index==0)
			            oldBack();
			    })
			}
			$(function () {
			        $("#dateSelect").click(function () {
			            var dtPicker = new mui.DtPicker({ type: 'date' });
			            /*参数：'datetime'-完整日期视图(年月日时分)
			                    'date'--年视图(年月日)
			                    'time' --时间视图(时分)
			                    'month'--月视图(年月)
			                    'hour'--时视图(年月日时)
			            */      
			            dtPicker.show(function (selectItems) {
			               var y = selectItems.y.text;  //获取选择的年
			               var m = selectItems.m.text;  //获取选择的月
			               var d = selectItems.d.text;  //获取选择的日
			               var date = y + "-" + m + "-" + d ; 
			               $("#dateSelect").val(date); 
			            })
			        });
			    })
		</script>
		
		<!-- 图片上传 -->
		<script>
		    var procinstid = 0;  
		    //初始化页面执行操作  
		    function plusReady() {  
		        //Android返回键监听事件  
		        plus.key.addEventListener('backbutton',function(){  
		            myclose();  
		        },false);  
		    }  
		    if (window.plus) {  
		        plusReady();  
		    } else {  
		        document.addEventListener('plusready', plusReady, false);  
		    }  
		        //加载页面初始化需要加载的图片信息  
		        //或者相册IMG_20160704_112620.jpg  
		        //imgId:图片名称：1467602809090或者IMG_20160704_112620  
		        //imgkey:字段例如：F_ZDDZZ  
		        //ID：站点编号ID,例如429  
		        //src：src="file:///storage/emulated/0/Android/data/io.dcloud.HBuilder/.HBuilder/apps/HBuilder/doc/upload/F_ZDDZZ-1467602809090.jpg"  
		        function showImgDetail (imgId,imgkey,id,src) {    
		            var html = "";  
		            html +='<div  id="Img'+imgId+imgkey+'" class="image-item ">';   
		            html +='    <img id="picBig" data-preview-src="" data-preview-group="1" '+src+'/>';  
		            html +='    <span class="del" onclick="delImg(\''+imgId+'\',\''+imgkey+'\','+id+');">';         
		            html +='        <div class="fa fa-times-circle"></div>';      
		            html +='    </span>';   
		            html +='</div>';  
		            $("#"+imgkey+"S").append(html);  
		        }  
		        //删除图片  
		        //imgId:图片名称：IMG_20160704_112614  
		        //imgkey:字段，例如F_ZDDZZ  
		        //ID：站点编号ID，例如429  
		        function delImg(imgId,imgkey,id){  
		            var bts = ["是", "否"];  
		            plus.nativeUI.confirm("是否删除图片？", function(e) {  
		                    var i = e.index;  
		                    if (i == 0) {  
		                        var itemname=id+"img-"+imgkey;//429img-F_ZDDZZ  
		                        var itemvalue=plus.storage.getItem(itemname);  
		                        //{IMG_20160704_112614,_doc/upload/F_ZDDZZ-IMG_20160704_112614.jpg,file:///storage/emulated/0/Android/data/io.dcloud...../doc/upload/F_ZDDZZ-1467602809090.jpg}  
		                        if(itemvalue!=null){  
		                            var index=itemvalue.indexOf(imgId+",");  
		                            if(index==-1){//没有找到  
		                                delImgfromint(imgId,imgkey,id,index);  
		                            }else{   
		                                delImgFromLocal(itemname,itemvalue,imgId,imgkey,index); //修改，加了一个index参数  
		                            }  
		                              
		                        }else{  
		                            delImgfromint(imgId,imgkey,id);   
		                        }  
		                    }  
		                },"查勘", bts);  
		            /*var isdel = confirm("是否删除图片？");  
		            if(isdel == false){  
		                return;  
		            }*/  
		              
		              
		        }  
		        function delImgFromLocal(itemname,itemvalue,imgId,imgkey,index){  
		                    var wa = plus.nativeUI.showWaiting();  
		                    var left=itemvalue.substr(0,index-1);  
		                    var right=itemvalue.substring(index,itemvalue.length);  
		                    var end=right.indexOf("}");  
		                    right=right.substring(end+1,right.length);  
		                    var newitem=left+right;  
		                    plus.storage.setItem(itemname,newitem);   
		                    //myAlert("删除成功");  
		                    $("#Img"+imgId+imgkey).remove();  
		                    wa.close();  
		        }  
		        //选取图片的来源，拍照和相册  
		        function showActionSheet(conf){  
		              var divid = conf.id;  
		              var actionbuttons=[{title:"拍照"},{title:"相册选取"}];  
		              var actionstyle={title:"选择照片",cancel:"取消",buttons:actionbuttons};  
		              plus.nativeUI.actionSheet(actionstyle, function(e){  
		                    if(e.index==1){  
		                        getImage(divid);  
		                    }else if(e.index==2){  
		                        galleryImg(divid);  
		                    }  
		              } );  
		        }  
		        function galleryImg(divid){
		        		plus.gallery.pick( function(e){
		        		//alert(e.files.length);
		        		var zm=0;
		        		setTimeout(file,200);
			    	    function file(){
			    	    	plus.io.resolveLocalFileSystemURL(e.files[zm], function(entry) {
							         compressImage(entry.toLocalURL(),entry.name,divid); 
						    }, function(e) {
							   plus.nativeUI.toast("读取拍照文件错误：" + e.message);
						    });
						    zm++;
						    if(zm<e.files.length){
						    	setTimeout(file,200);
						    }
			    	    }
		    	         
		                }, function ( e ) {
		    	           console.log( "取消选择图片" );
		                },{filename: "_doc/camera/",
		                   filter:"image",
		                   multiple:true
		                });
		         }
		        // 拍照  
		        function getImage(divid) {  
		            var cmr = plus.camera.getCamera();  
		            cmr.captureImage(function(p) {  
		                //alert(p);//_doc/camera/1467602809090.jpg  
		                plus.io.resolveLocalFileSystemURL(p, function(entry) {  
		                    //alert(entry.toLocalURL());//file:///storage/emulated/0/Android/data/io.dcloud...../doc/camera/1467602809090.jpg  
		                    //alert(entry.name);//1467602809090.jpg  
		                    compressImage(entry.toLocalURL(),entry.name,divid);  
		                }, function(e) {  
		                    plus.nativeUI.toast("读取拍照文件错误：" + e.message);  
		                });  
		            }, function(e) {  
		            }, {  
		                filename: "_doc/camera/",  
		                index: 1  
		            });  
		        }  
		        //压缩图片  
		        function compressImage(url,filename,divid){  
		            var name="_doc/upload/"+divid+"-"+filename;//_doc/upload/F_ZDDZZ-1467602809090.jpg  
		            plus.zip.compressImage({  
		                    src:url,//src: (String 类型 )压缩转换原始图片的路径  
		                    dst:name,//压缩转换目标图片的路径  
		                    quality:20,//quality: (Number 类型 )压缩图片的质量.取值范围为1-100  
		                    overwrite:true//overwrite: (Boolean 类型 )覆盖生成新文件  
		                },  
		                function(event) {   
		                    //uploadf(event.target,divid);  
		                    var path = name;//压缩转换目标图片的路径  
		                    //event.target获取压缩转换后的图片url路  
		                    //filename图片名称  
		                    saveimage(event.target,divid,filename,path);  
		                },function(error) {  
		                    plus.nativeUI.toast("压缩图片失败，请稍候再试");  
		            });  
		        }  
		        //保存信息到本地  
		        /**  
		         *   
		         * @param {Object} url  图片的地址  
		         * @param {Object} divid  字段的名称  
		         * @param {Object} name   图片的名称  
		         */  
		        function saveimage(url,divid,name,path){  
		            //alert(url);//file:///storage/emulated/0/Android/data/io.dcloud...../doc/upload/F_ZDDZZ-1467602809090.jpg  
		            //alert(path);//_doc/upload/F_ZDDZZ-1467602809090.jpg  
		            var  state=0;  
		            var wt = plus.nativeUI.showWaiting();  
		          //  plus.storage.clear();   
		            name=name.substring(0,name.indexOf("."));//图片名称：1467602809090  
		            var id = document.getElementById("ckjl.id").value;  
		            var itemname=id+"img-"+divid;//429img-F_ZDDZ  
		            var itemvalue=plus.storage.getItem(itemname);  
		            if(itemvalue==null){  
		                itemvalue="{"+name+","+path+","+url+"}";//{IMG_20160704_112614,_doc/upload/F_ZDDZZ-IMG_20160704_112614.jpg,file:///storage/emulated/0/Android/data/io.dcloud...../doc/upload/F_ZDDZZ-1467602809090.jpg}  
		            }else{    
		                itemvalue=itemvalue+"{"+name+","+path+","+url+"}";  
		            }  
		            plus.storage.setItem(itemname, itemvalue);  
		              
		            var src = 'src="'+url+'"';  
		            //alert("itemvalue="+itemvalue);  
		            showImgDetail(name,divid,id,src);  
		            wt.close();  
		              
		        }  
		        //上传图片，实例中没有添加上传按钮  
		        function uploadimge(agree,back) {  
		        //plus.storage.clear();  
		         var wa = plus.nativeUI.showWaiting();  
		         var DkeyNames=[];  
		         var id = document.getElementById("ckjl.id").value;   
		         var length=id.toString().length;   
		         var idnmae=id.toString();  
		         var numKeys=plus.storage.getLength();  
		         var task = plus.uploader.createUpload(getUrl() + 'url', {  
		                                method: "POST"  
		                            },  
		                            function(t, status) {  
		                                if (status == 200) {  
		                                    console.log("上传成功");  
		                                     $.ajax({  
		                                        type: "post",  
		                                        url: getUrl() + 'url',  
		                                        data: {  
		                                            taskId: taskId,  
		                                            voteAgree: agree,  
		                                            back: back,  
		                                            voteContent: $("#assign").val(),  
		                                        },  
		                                        async: true,  
		                                        dataType: "text",  
		                                        success: function(data) {  
		                                            wa.close();  
		                                            goList(data);  
		                                          
		                                              
		                                        },  
		                                        error: function() {  
		                                            wa.close();  
		                                            myAlert("网络错误，提交审批失败，请稍候再试");  
		                                        }  
		                                    });  
		                                       
		                                      
		                                } else {  
		                                    wa.close();  
		                                    console.log("上传失败");   
		                                }  
		                            }  
		                        );  
		            task.addData("id",id);  
		            for(var i=0; i<imgArray.length;i++){    
		                var itemkey=id+"img-"+imgArray[i];  
		                if(plus.storage.getItem(itemkey)!=null){  
		                    var itemvalue=plus.storage.getItem(itemkey).split("{");  
		                    for(var img=1;img<itemvalue.length;img++){  
		                        var imgname=itemvalue[img].substr(0,itemvalue[img].indexOf(","));  
		                        var imgurl=itemvalue[img].substring(itemvalue[img].indexOf(",")+1,itemvalue[img].lastIndexOf(","));  
		                        task.addFile(imgurl,{key:imgurl});  
		                    }  
		                }  
		            }  
		            task.start();  
		              
		        }  
		</script>
		
		<!-- 上传视频 -->
		<script type="text/javascript">
						mui.init();
			var i=1,gentry=null,w=null;
			var hl=null,le=null,de=null,ie=null;
			var unv=true;
			var bUpdated=false; //用于兼容可能提前注入导致DOM未解析完更新的问题
			// H5 plus事件处理
			function plusReady(){
				// 获取摄像头目录对象
				plus.io.resolveLocalFileSystemURL('_doc/', function(entry){
					entry.getDirectory('camera', {create:true}, function(dir){
						gentry = dir;
						updateHistory();
					}, function(e){
						outSet('Get directory "camera" failed: '+e.message);
					} );
				}, function(e){
					outSet('Resolve "_doc/" failed: '+e.message);
				});
			}
			if(window.plus){
				plusReady();
			}else{
				document.addEventListener('plusready', plusReady, false);
			}
			// 监听DOMContentLoaded事件
			document.addEventListener('DOMContentLoaded', function(){
				// 获取DOM元素对象
				hl=document.getElementById('history');
				le=document.getElementById('empty');
				de=document.getElementById('display');
				if(ie=document.getElementById('index')){
					ie.onchange=indexChanged;
				}
				// 判断是否支持video标签
				unv=!document.createElement('video').canPlayType;
				updateHistory();
			},false );
			function changeIndex(){
				outSet('选择摄像头：');
				ie.focus();
			}
			function indexChanged(){
				de.innerText = ie.options[ie.selectedIndex].innerText;
				i = parseInt(ie.value);
				outLine(de.innerText);
			}
			
			// 显示文件
			function displayFile(li){
				if(w){
					outLine('重复点击！');
					return;
				}
				if(!li || !li.entry){
					ouSet('无效的媒体文件');
					return;
				}
				var name = li.entry.name;
				var suffix = name.substr(name.lastIndexOf('.'));
				var url = '';
				if(suffix=='.mov' || suffix=='.3gp' || suffix=='.mp4' || suffix=='.avi'){
					//if(unv){plus.runtime.openFile('_doc/camera/'+name);return;}
					url = '/camera_video.html';
				} else {
					url = '/camera_image.html';
				}
				w=plus.webview.create(url,url,{hardwareAccelerated:true,scrollIndicator:'none',scalable:true,bounce:'all'});
				w.addEventListener('loaded', function(){
					w.evalJS('loadMedia("'+li.entry.toLocalURL()+'")');
					//w.evalJS('loadMedia("'+'http://localhost:13131/_doc/camera/'+name+'")');
				}, false );
				w.addEventListener('close', function(){
					w = null;
				}, false);
				w.show('pop-in');
			}
			
			// 添加播放项
			function createItem(entry){
				cleanHistory();
				var li = document.createElement('li');
				li.className = 'ditem';
				li.innerHTML = '<span class="iplay"><font class="aname"></font><br/><font class="ainf"></font></span>';
				li.setAttribute('onclick', 'displayFile(this)' );
				hl.insertBefore( li, le.nextSibling );
				li.querySelector('.aname').innerText = entry.name;
				li.querySelector('.ainf').innerText = '...';
				li.entry = entry;
				updateInformation(li);
				// 设置空项不可见
				le.style.display = 'none';
			}
			// 获取录音文件信息
			function updateInformation(li){
				if(!li || !li.entry){
					return;
				}
				var entry = li.entry;
				entry.getMetadata(function(metadata){
					li.querySelector('.ainf').innerText = dateToStr(metadata.modificationTime);
				}, function(e){
					outLine('获取文件"'+entry.name+'"信息失败：'+e.message);
				} );
			}
			// 获取录音历史列表
			function updateHistory(){
				if(bUpdated||!gentry||!document.body){//兼容可能提前注入导致DOM未解析完更新的问题
					return;
				}
			  	var reader = gentry.createReader();
			  	reader.readEntries(function(entries){
			  		for(var i in entries){
			  			if(entries[i].isFile){
			  				createItem(entries[i]);
			  			}
			  		}
			  	}, function(e){
			  		outLine('读取录音列表失败：'+e.message);
			  	});
			  	bUpdated = true;
			}
			// 清除历史记录
			function cleanHistory(){
				if(flag){
					hl.innerHTML = '<li id="empty" class="ditem-empty">无历史记录</li>';
					le = document.getElementById('empty');
					// 删除音频文件
					outSet('清空拍照录像历史记录：');
					gentry.removeRecursively(function(){
						// Success
						outLine('成功！');
					}, function(e){
						outLine('失败：'+e.message);
					});
					file=null;
				}
			}
			
			 
			
					</script>
		<script>
				mui.init();
				var file=null;
				var flag=false;
				document.getElementById('video').addEventListener('tap', function(){
				            if (mui.os.plus) { 
				                var a = [{ 
				                    title: "录像" 
				                }, { 
				                    title: "从手机相册选择" 
				                }]; 
				                plus.nativeUI.actionSheet({ 
				                    title: "上传视频", 
				                    cancel: "取消", 
				                    buttons: a 
				                }, function(b) { /*actionSheet 按钮点击事件*/ 
				                    switch (b.index) { 
				                        case 0: 
				                            break; 
				                        case 1: 
				                            getVideo(); /*录像*/ 
				                            break; 
				                        case 2: 
				                            galleryVideo();/*打开相册 找录像*/ 
				                            break; 
				                        default: 
				                            break; 
				                    } 
				                }) 
				            } 
				        }, false); 
				        /*这是打开录像的事件*/
				        function getVideo(){
				           	var cmr = plus.camera.getCamera();
				            var res = cmr.supportedVideoResolutions[0];//获取支持的分辨率，拿默认的第一个
				            var fmt = cmr.supportedVideoFormats[0];//获取支持的录像文件格式，拿默认的第一个
				            cmr.startVideoCapture( function( e ){//录像成功后会返回一个路径到e这里
				                    plus.io.resolveLocalFileSystemURL(e, function(entry){//这个是根据路径读取文件信息，其实这步可以省略。
									createItem(entry);
									flag=true;
									file=e;
				                        //uploadVideo(e);
				                    }, function(e){
				                        console.log("读取录像文件错误：" + e.message);
				                    });
				            },function( error ) {
				                    mui.toast("取消录制");
				                },
				                {resolution:res,format:fmt,videoMaximumDuration:30}
				            );
				      
					}
				
				        
				        function uploadVideo(file){ 
				            //第二个参数一定要有，然后把文件路径扔进来
				            var task=plus.uploader.createUpload(basePath+"/weChatEventController.do?upload", {processData: false, contentType: "multipart/form-data"}, function (t, status){
				                if(status==200){
				//                    alert( "Upload success: " + t.url );
				//                    alert(t.responseText);
				                    var responseText = $.parseJSON(t.responseText);
				                    alert(responseText.obj);
				                    var filePath = "<input type=\"hidden\" name=\"filePath\" value=\""+responseText.obj+"\">";//文件地址
				                    jQuery("#videos").append(filePath);
				                } else {
				                    mui.toast("上传失败了。sorry，请重新来一遍");
				                }
				            });
				            task.addFile( file, {key:"file"} );//这里是根据文件路径找到对应的文件,然后以file的参数名字扔给后台
				            task.addData( "type", saveType );//这里是其他参数
				            task.start();//开始上传
				        }
				        
				        //本地相册选择 
				        function galleryVideo(){
				            // 从相册中选择图片
				            plus.gallery.pick( function(e){//打开相册后，回调的文件路径e
								plus.io.resolveLocalFileSystemURL(e, function(entry){//这个是根据路径读取文件信息，其实这步可以省略。
									createItem(entry);
									flag=true;
									file=e;
				                        //uploadVideo(e);
				                    }, function(e){
				                        console.log("读取文件错误：" + e.message);
				                    });
				            }, function ( e ) {
				                mui.toast( "您取消了选择视频" );
				            },{
				                filter: "video",//只打开视频，但是不知道为什么有其他选项
				                system: false//不用系统自带的打开相册功能
				            });
				        }
				function ti(){
					//上传
					uploadVideo(file);
				}
			</script>
	</body>

</html>
