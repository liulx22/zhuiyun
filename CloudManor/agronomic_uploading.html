<!DOCTYPE html>
<html lang="zh-Hans">
	<head>
	   <meta charset="utf-8">
	   <meta name="viewport" content="initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
	    
	    <title>上传农事</title>
	   
	    <script src="resource/css/zbw/jquery.min.js" type="text/javascript"></script>
	    <script src="resource/css/zbw/hmt.js" type="text/javascript"></script>
	    <script type="text/javascript" src="resource/css/zbw/swipe.js"></script>
	    
	    <link rel="stylesheet" type="text/css" href="resource/css/zbw/base.css"/>
	    <link rel="stylesheet" type="text/css" href="resource/css/zbw/base1.css"/>
	    <link rel="stylesheet" type="text/css" href="resource/css/zbw/common.css"/>
	    <link rel="stylesheet" type="text/css" href="resource/css/zbw/style.css"/>
		
		<link rel="stylesheet" type="text/css" href="resource/css/zbw/base.css"/>
		  <script type="text/javascript" src="//at.alicdn.com/t/font_1939224_4ye6421qdyi.js"></script>
		<!-- <link rel="stylesheet" type="text/css" href="resource/mui/css/mui.css"/> -->
		  <script src="resource/mui/js/mui.js"></script>
		   <script src="resource/css/zbw/jaliswall.js"></script>
		  <!--标准mui.css-->
		  <link rel="stylesheet" type="text/css" href="resource/css/zbw/zbw_mui.css"/>
		  <!-- 引入外部json文件 -->
		  <script type="text/javascript" src="file/zbw/cultivate.json"></script>
		  <script src="./resource/js/common.js"></script>
		  <!-- 阿里图标样式 -->
		<style type="text/css">
		    .icon {
				
		       width: 2.4em; height: 2.4em;
		       vertical-align: -0.75em;
		       fill: currentColor;
		       overflow: hidden;
		    }
			#div {
							width: 0px;
							height: 0px;
							background: red;
							position: fixed;
							top: 70%;
							left: 50%;
						}
			.mui-popover .mui-popover-arrow:after {
				width: 0px;
			}
		</style>
		<script type="text/javascript">
			
		
		
			function mycheck(val) {
				if ($("#collect" + val).is(':checked')) {
					$(".label" + val).addClass("collectd");
					$(".collectbox").fadeIn(300);
					$(".kong").fadeIn();
				} else {
					$(".label" + val).removeClass("collectd");
					$(".collectbox").fadeOut(300);
					$(".kong").fadeOut();
				}
			}
			var count = 0
		
			function showEditButton() {
				console.log(3333)
				var className = "[id^=checkButton_]" + " label";
				count++
				if (count % 2 == 1) {
					$(className).removeClass('shopcar-checkd');
					$("[id^=checkButton]").show();
					$("#deleteButton").show();
				} else {
					$("[id^=checkButton]").hide();
					$("#deleteButton").hide();
				}
			}
		
			function checkHiddenBox(id) {
				var className = "#checkButton_" + id + " label";
				if ($(className).hasClass('shopcar-checkd')) {
					$(className).removeClass('shopcar-checkd');
				} else {
					$(className).addClass('shopcar-checkd');
				}
			}
		
			function cancelCollect() {
				var arrr=[];
				$("label").each(function() {
					if ($(this).hasClass('shopcar-checkd')) {
						console.log($(this).attr('id'));
						var celectId = $(this).attr('id');
						var idd = parseInt(celectId)
						arrr.push(idd);
						aarr.push(idd);
					}
				});
				if(arrr.length==0){
					mui.alert('至少选择一个资源！', '警告', function() {
					   mui.toast('请重新选择');
					});
				}else{
					//调用隐藏/显示弹出层
					mui("#popover").popover('toggle', document.getElementById("div"));
				}
				console.log("要上传的资源id是：",arrr)
				//将arrr传入后台进行删除即可
			}
		</script>
	</head>
	<body class="fx-center">
		<div class="warp clearfloat fixed-cont" >
			<!--header star-->
			<div class="header2 clearfloat box-s" id="header">
				<div class="left1 clearfloat fl">
					<a href="javascript:history.go(-1)" class="back">
						<img src="resource/css/zbw/left.jpg"/>
					</a>
				</div>
				<div class="middle clearfloat fl" >
					上传农事
				</div>
			</div>
			<!--header end-->
			<!--p-center star-->
			<div id="main"  class="clearfloat" style="margin-top: -18%;">
				
				<div class="p-list p-listtwo clearfloat" style="margin-bottom: 25%;">
					<ul id="liebiao">
						<a id="xuanzeziy" href="#">
							<li class="box-s">
								<p class="">
									<svg class="icon" aria-hidden="true">
									    <use xlink:href="#icon-tianjia"></use>
									</svg>
									选择资源</p>
							</li>
							
						</a>
						
							<!-- 自定义弹出层start -->
							<div id="div"></div>
							<div id="popover" class="mui-popover" style="height: 250px;">
								<div class="mui-popover-arrow"></div>
								<div><!-- 我是自定义位置弹出层 -->
								<div style="margin-top: 0em;" class="contaniner fixed-conta">
									<form style="margin: 1% 0;" action="" method="post"  class="change-address" id="save">
										<ul>
											<li>
												<label style=" width: 24%;font-size: 0.35em;" class="addd">标题：</label>
												<input id="biaoti" style="width: 60%;font-size: 0.45em;" type="text" value="" required="required"/>
											</li>
											<li style="height: 5em;">
												<label style=" width: 24%;font-size: 0.25em;" class="addd">描述：</label>
												<textarea id="miaoshu" style="width: 60%;font-size: 0.45em;" required="required"></textarea>
											</li>
										</ul>
										
										<ul>
											<li style="height: 2em;">
												<h3 id="quxiaoxianshi" style="font-size: 0.98em;line-height: 2em;">取消</h3>
											</li>
										</ul>
										<input id="baocun" style="height: 0.7em;font-size: 1.25em;" type="submit" value="保存" />
									</form>
								</div>
								</div>
							</div>
							<!-- 自定义弹出层end -->
				
						
						
						<!-- 全部资源展示 start-->
						<div style="margin-left: 0.8em;margin-right: 0.8em;" class="mui-content " id="tttt">
									
										<div id="item1mobile" style="overflow: hidden;" class="mui-slider-item mui-control-content mui-active" style="background-color: #EBEDED;">
											<div >
												<div id="j_neirong" >
										<!-- 列表 start-->
										
										<div id="neirong1" class="contaniner fixed-contb" style="margin-bottom: 0em;">
											
											
											
										
										
											
											
										
										
										
											
											
										</div>
										<!-- 列表 end -->
										</div>
									</div>
									</div>
								</div>
						<!-- 全部资源展示 end -->
					</ul>
				</div>
			</div>
			<!--底部不够-->
			<div style="margin-bottom: 9%;"></div>
		</div>
		
		<!--p-center end-->
			<footer   style="z-index: 2;" class="buy-footer2 fixed-footer">
					
						<input id="scnongshi" type="button" value="上传农事"/>
			</footer>
	</body>
</html>

<script>
	var  aarr=[];
	mui.init()
		var lastPage=1;  //总共页数
	　　　var currPage=1; //当前页码
	　　　　var counter=1; //计数器
	
		
			//可多次调用
			mui("#item1mobile").pullRefresh({
			up: {
			height:50,//可选.默认50.触发上拉加载拖动距离
			auto:true,//可选,默认false.自动上拉加载一次
			contentrefresh : "正在加载...",//可选，正在加载状态时，上拉加载控件上显示的标题内容
			contentnomore:'没有更多数据了',//可选，请求完毕若没有更多数据时显示的提醒内容；
			callback :pullupRefresh //必选，刷新函数，根据具体业务来编写，比如通过ajax从服务器获取新数据；
			},
			})
			
					//已售出分页
					function pullupRefresh(){
									  getList();
					                  setTimeout(function(){
					                      mui('#item1mobile').pullRefresh().endPullupToRefresh((++counter>lastPage));
					                  },1500)
					              }
					
				  //已售出获取数据
				  function getList(){
					  //取出用户信息
					  var userInfo=JSON.parse(localStorage.getItem('userInfo'))
					  console.log(userInfo.id);
					  $.ajax({
					  	//请求方式为post
					  	type:"post",
					  	//json文件位置
					  	url:commonJavaUrl+"CultivatePersonCenterController/pullConservationResources",
					  	data:{'userId':userInfo.id,'type':1},
					  	//返回数据格式为json
					  	dataType: "json",
					  	//请求成功完成后要执行的方法
					  	success: function(data){
					  			    var result=data;
					  			     if(result.length==0||result==null||result==undefined){
										 $("#neirong1").html("")
					  			    	var  pp= '<div style="height: 3.2em;" class="mui-card"><div class="mui-card-header" style="padding-bottom: 0.1em; padding-top: 0.1em;padding:0 auto;"><p style="font-size:1.2rem;text-align:center;width:23em">暂无已售出资源</p></div></div>'
					  			    	
					  			    	 jQuery(pp).insertBefore('#j_neirong');
					  			    	}else{
					  						
					  													/* if(result.length==0||result==null||result==undefined){
					  														
					  													} */
					  														$("#neirong1").html("")
					  										  　　　　　		$.each(result,function(i,value){
					  															console.log(value)
					  									　　　　　　　　　　　　 var oo="<section id=\"resource_"+value.id+"\" class=\"shopcar\" style=\"height: 9em; width: 96%;margin-left: 2%; margin-right: 2%; margin-top: 0px;\">\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<div class=\"shopcar-checkbox\" id=\"checkButton_"+value.id+"\" style=\"display: none;\">\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<label for=\"shopcar\" onselectstart=\"return false\" id=\""+value.id+"\" onclick=\"checkHiddenBox("+value.id+")\"></label>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"checkbox\" name=\"shopcar\" />\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<input type=\"hidden\" id=\"id_"+value.id+"\" />\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</div>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<figure  id=\""+value.id+"\" ><img src=\"https://lzj-picservice.oss-cn-beijing.aliyuncs.com/CloudManor_Pic/resource/pictrue/"+value.imgName+"\" /></figure>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<dl id=\""+value.id+"\"  onclick=\"ziyuanxq("+value.id+")\">\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<dt>"+value.title+"</dt>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<dd><svg style=\"width: 1.3em; vertical-align: -0.75em;\" class=\"icon\" aria-hidden=\"true\">\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<use xlink:href=\"#icon-dianzan1\"></use>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>  点赞："+value.dianzan+"</dd>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<dd><svg style=\"width: 1.3em;\" class=\"icon\" aria-hidden=\"true\">\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<use xlink:href=\"#icon-shoucang\"></use>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>  收藏："+value.shoucang+"</dd>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<dd><svg style=\"width: 1.3em;vertical-align: -0.88em;\" class=\"icon\" aria-hidden=\"true\">\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<use xlink:href=\"#icon-pinglun2\"></use>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</svg>  评论："+value.pinglun+"</dd>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t<h3 style=\"font-size: 1.4em; top: 73%;right: 51%;\">￥"+value.money+"</h3>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</dl>\n" +
					  						"\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t</section>";
					  																				$("#neirong1").append(oo)
					  																				   /* jQuery(oo).insertBefore('#neirong1'); */
					  										
					  									                        })					
					  					} 
					  					   }
					  });
					  
				         　
				  
				  				}
				 
								
								
								
								function chakan(id){
									/* var topicId=event.attr('onselectstart'); *///获取点击li标签的话题id;
									console.log("点击事件id=="+id);
									 checkHiddenBox(id)
								}
								function yinCangDelete(){
									$("#deleteButton").hide();
									$("#deleteButton2").hide();
								}
								function tijiao(){
									//取出用户信息
									var userInfo=JSON.parse(localStorage.getItem('userInfo'))
									console.log(userInfo.id);
									var pp=$("#biaoti").val();
									console.log(pp)
									var oo=$("#miaoshu").val();
									console.log(oo)
									if(pp==""||pp==null||oo==""||oo==null){
										mui.alert('信息不能为空！', '提示', function() {
										   mui.toast('重新填写');
										});
									}
									$.ajax({
										//请求方式为post
										type:"post",
										//json文件位置
										url:commonJavaUrl+"CultivatePersonCenterController/batchCommitResources",
										data:{'userId':userInfo.id,"resouceId":aarr,"content":oo},
										//返回数据格式为json
										dataType: "json",
										traditional:true,
										//请求成功完成后要执行的方法
										success: function(data){
											mui.alert('提交成功！', '提示', function() {
											   mui.toast('提交成功');
											});	    
														   }
									});
								}
								
								/* mui的页面预加载 */
								(function($) {
									
									
									 //点击弹出框的确认上传农事按钮。进行上传，触发隐藏弹出框
									mui("#popover").on('tap','#baocun',function(){
									 //console.log("点击事件");
									/* mui.openWindow({
									 url : 'agronomic_uploading.html',
									 id : 'agronomic_uploading.html'
									 }); */
										tijiao();
										mui('.mui-popover').popover('hide');//隐藏
										
									}) 
									
									 //点击弹出框的取消上传农事按钮。触发隐藏弹出框
									mui("ul").on('tap','#quxiaoxianshi',function(){
									 //console.log("点击事件");
										mui('.mui-popover').popover('hide');//隐藏
									}) 
									
									mui("#neirong1").on('tap','label',function(){
									 //console.log("点击事件");
									 chakan(this.id)
									})  
									 //点击上传农事按钮。触发确认删除函数
									mui("footer").on('tap','#scnongshi',function(){
									 //console.log("点击事件");
									 var btnArray = ['否', '是'];
									 mui.confirm('至少选择一个资源，确认？', '提示', btnArray, function(e) {
									     if (e.index == 1) {
									        console.log("你选择了是");
											cancelCollect();
									     } else {
									        console.log(2);
									     }
									 })
									 console.log(3335)
									})   
									/* a标签加点击事件 */
									mui('ul').on('tap', 'a', function() {                                        
									       //显示多选框
									      showEditButton();
									});
											$("#item1mobile").on('tap', 'div', function (event) {
											this.click();
											});
											       　　$("#item2mobile").on('tap', 'div', function (event) {
											this.click();
											});
											
											mui("label").on('tap', 'div', function (event) {
											this.click();
											});
											　　　　
										//
								/* aaa(); */
										
									})(mui);
									
</script>
