<!DOCTYPE html>
<html class="feedback">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title></title>
	<script src="./resource/jquery-3.2.1.js"></script>
    <link href="./resource/mui/css/mui.min.css" rel="stylesheet"/>
	<link rel="stylesheet" type="text/css" href="./resource/css/fangh/app.css" />
	<link rel="stylesheet" type="text/css" href="./resource/css/fangh/iconfont.css" />  
	<link rel="stylesheet" type="text/css" href="./resource/css/fangh/feedback-page.css" />  
	<link rel="stylesheet" href="./resource/css/fangh/font-awesome.min.css">  
	<script type="text/javascript" src="./resource/js/fangh/common.js"></script>
	<script type="text/javascript" src="./resource/js/common.js"></script>  
	<script type="text/javascript" src="./resource/js/fangh/utitls.js"></script>  
	
	<!-- 图片css -->
	<style type="text/css">  
	    .del {  
	        position: absolute;  
	        top:1px;  
	        right: 1px;   
	        display: block;        
	     line-height: 1;  
	        cursor: pointer;  
	        color:#000000;  
	        }  
	  
	    .del:hover {  
	        color:#ff3333;  
	    }  
	</style>  
	<style>  
	    .table-view {  
	        position: relative;  
	        margin-top: 0;  
	        margin-bottom: 0;  
	        padding-left: 0;  
	        list-style: none;  
	        background-color: #f5f5f5;  
	    }  
	      
	    .table-view-cell {  
	        position: relative;  
	        overflow: hidden;  
	        padding: 0px 15px;  
	        -webkit-touch-callout: none;  
	        margin-bottom: 1px;  
	    }  
	      
	    .table-view-cell:after {  
	        position: absolute;  
	        right: 0;  
	        bottom: 0;  
	        left: 0px;  
	        height: 1px;  
	        content: '';  
	        -webkit-transform: scaleY(.5);  
	        transform: scaleY(.5);  
	        background-color: #c8c7cc;  
	    }  
	      
	    .table-view-cell>a:not(.btn) {  
	        position: relative;  
	        display: block;  
	        overflow: hidden;  
	        margin: -0px -15px;  
	        padding: inherit;  
	        white-space: nowrap;  
	        text-overflow: ellipsis;  
	        color: inherit;  
	        background-color: #75b9f4;  
	        height: 40px;  
	        line-height: 40px;  
	    }  
	      
	    .navigate-right:after  
	    {  
	        font-family: Muiicons;  
	        font-size: inherit;  
	        line-height: 1;  
	        position: absolute;  
	        top: 50%;  
	        display: inline-block;  
	        -webkit-transform: translateY(-50%);  
	        transform: translateY(-50%);  
	        text-decoration: none;  
	        color: #666;  
	        -webkit-font-smoothing: antialiased;  
	    }  
	      
	    .table-view-cell.collapse .collapse-content {  
	        position: relative;  
	        display: none;  
	        overflow: hidden;  
	        margin: 0px -15px 0px;  
	        padding: 0px 0px !important;  
	        -webkit-transition: height .35s ease;  
	        -o-transition: height .35s ease;  
	        transition: height .35s ease;  
	        background-color: transparent;  
	    }  
	    .image-item{  
	        position: relative;  
	    }  
	    .image-item .info{  
	        position: absolute;  
	        top:0px;  
	        left:4px;  
	        color: #ff9900;  
	        font-size: 12px;                          
	          
	    } 
	</style> 
	 <!-- 参数css-->
	<style>
		.mui-input-row{
			font-size: 12px;
		}
		.mui-input-row input{
			font-size: 12px;
		}
		input::-webkit-input-placeholder{
			font-size:12px;
		}
	</style>
	<!-- 视频css -->
	<style type="text/css">
	.aname {
		font-size: 10px;
	}
	.ainf {
		font-size: 10px;
	}
	.iplay {
		display: block;
		margin-right: 10%;
		background: no-repeat right center url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAGQAAABYCAYAAAADWlKCAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAAKwwAACsMBNCkkqwAAABZ0RVh0Q3JlYXRpb24gVGltZQAwOS8xMi8xM5w+I3MAAAAcdEVYdFNvZnR3YXJlAEFkb2JlIEZpcmV3b3JrcyBDUzVxteM2AAAD9UlEQVR4nO2b3XETMRRGDwzvoYOkg5hRAVkqiKmAdIA7wHSQVECoALsC1gXciV0BTge4gvCwgnHk9d/+WF8m97ztxrlXs8fS1Urym6enJxwd3uZugPMcFyKGCxHDhYjhQsRwIWK4EDFciBguRAwXIoYLEcOFiOFCxHAhYrgQMVyIGC5EDBcihgsRw4WI4ULEcCFiuBAx3uVuwDGY2XtgCBTAALjc8tEFMAdKYBJC+HOK9nXBm5dwUM7MCmAEXDcMMQVuQwhlV23qC2khZjYAboGrjkLOgFEIYd5RvM6RrSFmdgs80J0MYqyHGFsSuR4S60TJ9vrwCEziZ+YhhGXy/xdU9aWgqjfnW+IsgEKtvkgJiUPUPfUyZsD42DoQ68+Y+p62AG6UhjAZITt6xopq3L9vGf+Gqh6dJX+S6ilKNaRkU8YCGLSVARBjDGLMdS5jbgkkhMQiWyejSGtEG2KsghopKoU++5AV68ZDcrvXYWTH8Pghdz1R6CHpN3MFDPsc02PsYcy1qy0nJ6uQOANKZz+jfcOUmd3H6W1jYo5RcvsqtikbuXtI+kBmBxbwz8DczMZtksdcsz1tOinZhMRxPF2bGh8R4gz4amZLMxu2aEqa8zq2LQs5e0j6EB8bLv6dAz/NrGwyjMWcj3vadjJyCimS60nLeFfAbzO7bfANT3MXLdvSmJxCBsl12VHcL8AyvpkfSpo7bdvJyCkkfQfocv5/Bnw3s/mBs6Y097aFzd7JPcv6T5dv5GtcAr/2TZN7yt0IGSE908k0+RS8FiEvhhd1yKEFUw5YAVBApoe0XQrZwgL4GEIY7pLRU+5G5OwhC57PZgbAsqPYK6rdxUMXC9Npbro8fzJy9pB0qll0FPcOuDhCRl3ubEvwOYWUyXXb5YoZ1X7GqMHSfZq7bNmWxuQUki5XnDdc+n4EPoUQiiabSzFnejKl7TJOY7IJid/iaXJ7fESIFfCNas+9zQNMc05zHnjIPctKx/mrA9egflCJGLd5eDFXukGWdddQYU+95PlDWVE97GXPeS+oivf6saBZCKHoM+8+cvcQ2NyhOwMmfW4SxdgTNs9oZd0tBAEhsRDfJbcvgbIPKTtOnNzlPnECAkPWP8xsTv3ZrJ1v2UfmuKDqGRt5QgjZ9kDWyd5D1iioP1U4P3KzqZYYY5v0om38rpDpIeCHrUFMCPjPEeSE/COetf3SU/i7EEL2GVUdSjXkGfGBfWDzIFsb/q93dRizU2R7yDr+o09R/GfRzsmRrSGvFRcihgsRw4WI4ULEcCFiuBAxXIgYLkQMFyKGCxHDhYjhQsRwIWK4EDFciBguRAwXIoYLEcOFiOFCxHAhYrgQMf4CVuqCm+17t3sAAAAASUVORK5CYII=);
		background-size: 40px 40px;
		-ms-touch-action: auto;
	}
	
	
			</style>
		<!-- 封面单图片css -->
		<style>
			 .load-img{
				 width: 60;
				 height:60;
			 }
			 .letter-photo{
				 width: 100%;
				 height: 100%;
			 }
			 .letter-photo-img{
				 float: left;
				 margin-left: 35%;
				 width: 40%;
				 height: 35%;
			 }
			 .letter-photo-img img{
				 width: 7rem;
				 height: 10.5rem;
			 }
		</style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
		<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
		<h1 class="mui-title">发布资源</h1>
	</header>
	<div class="mui-content">
		<form class="mui-input-group">
			<div class="mui-input-row">
				<label>标题：</label>
				<input name="title" id="title" type="text" class="mui-input-clear" placeholder="请输入标题">
			</div>
			<div class="mui-input-row">
				<label>描述：</label>
				<select name="reTypeCode" id="typed" style="font-size: 12px;">
					<option value="">请选择</option>
					<option value="fruiter">果树</option>
					<option value="livestock">畜牧业</option>
					<option value="plot">地块</option>
				</select>
			</div>
		</form>
			<!-- 果树 -->
			<div id="tree">
			<form id="tree1" class="mui-input-group">
			<div class="mui-input-row">
				<label>地理位置：</label>
				<input name="geographicPosition" type="text" class="mui-input-clear" placeholder="请输入地理位置">
			</div>
			<div class="mui-input-row">
				<label>品种名称：</label>
				<input name="breedName" type="text" class="mui-input-clear" placeholder="请输入品种名称">
			</div>
			<div class="mui-input-row">
				<label>树龄（年）：</label>
				<input name="treeAge" type="text" class="mui-input-clear" placeholder="请输入树龄（年）" onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
			</div>
			<div class="mui-input-row">
				<label>年产量：</label>
				<input name="yearlyOutput" type="number" class="mui-input-clear" placeholder="请输入年产量">
			</div>
			<div class="mui-input-row">
				<label>果树直径（cm）：</label>
				<input name="diameter" type="text" class="mui-input-clear" placeholder="请输入果树直径（cm）" onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
			</div>
			<div class="mui-input-row">
				<label>承包时间（年）：</label>
				<input name="leaseTime" type="date" class="mui-input-clear" placeholder="请输入承包时间（年）">
			</div>
			<div class="mui-input-row">
				<label>价格（元）：</label>
				<input name="money" type="number" class="mui-input-clear" placeholder="请输入价格（元）">
			</div>
			</form>
			</div>
			<!-- 畜牧业 -->
			<div id="Animal">
			<form id="Animal1" class="mui-input-group">
			<div class="mui-input-row">
				<label>地理位置：</label>
				<input name="geographicPosition" type="text" class="mui-input-clear" placeholder="请输入地理位置">
			</div>
			<div class="mui-input-row">
				<label>品种名称：</label>
				<input name="breedName" type="text" class="mui-input-clear" placeholder="请输入品种名称">
			</div>
			<div class="mui-input-row">
				<label>重量（斤）：</label>
				<input name="weight" type="number" class="mui-input-clear" placeholder="请输入重量（斤）">
			</div>
			<div class="mui-input-row">
				<label>颜色：</label>
				<input name="colour" type="text" class="mui-input-clear" placeholder="请输入颜色">
			</div>
			<div class="mui-input-row">
				<label>年龄（天）：</label>
				<input name="age" type="text" class="mui-input-clear" placeholder="请输入年龄（天）" onkeyup="value=value.replace(/^(0+)|[^\d]+/g,'')">
			</div>
			<div class="mui-input-row">
				<label>是否打过疫苗：</label>
				<input name="vaccine" value="是" style="float: none; width: 5%;margin-top: 9px;" class="mui-input-clear" type="radio"><span style=" font-size: 14px;">是</span>
				<input name="vaccine" value="否" style="float: none; width: 5%;" class="mui-input-clear" type="radio">
				<span style=" font-size: 14px;">否</span>
			</div>
			<div class="mui-input-row">
				<label>价格（元）：</label>
				<input name="money" type="number" class="mui-input-clear" placeholder="请输入价格（元）">
			</div>
			</form>
			</div>
			<!-- 地块 -->
			<div id="land">
			<form id="land1" class="mui-input-group">
			<div class="mui-input-row">
				<label>地理位置：</label>
				<input name="geographicPosition" type="text" class="mui-input-clear" placeholder="请输入地理位置">
			</div>
			<div class="mui-input-row">
				<label>去年种植什么：</label>
				<input name="plantType" type="text" class="mui-input-clear" placeholder="请输入去年种植什么">
			</div>
			<div class="mui-input-row">
				<label>产量（斤）：</label>
				<input name="yield" type="number" class="mui-input-clear" placeholder="请输入产量（斤）">
			</div>
			<div class="mui-input-row">
				<label>面积（平方米）：</label>
				<input name="proportion" type="number" class="mui-input-clear" placeholder="请输入面积（平方米）">
			</div>
			<div class="mui-input-row">
				<label>土地类型：</label>
				<select name="landType" style="font-size: 12px;">
					<option value="">请选择</option>
					<option value="耕地">耕地</option>
					<option value="山地">山地</option>
					<option value="林地">林地</option>
					<option value="水田">水田</option>
				</select>
			</div>
			<div class="mui-input-row">
				<label>承包时间（年）：</label>
				<input name="leaseTime" type="date" class="mui-input-clear" placeholder="请输入承包时间（年）">
			</div>
			<div class="mui-input-row">
				<label>价格（元）：</label>
				<input name="money" type="number" class="mui-input-clear" placeholder="请输入价格（元）">
			</div>
			</form>
			</div>
			<!-- 上传视频 -->
			<form class="mui-input-group">
				<div class="mui-input-row">
					<label id="video" type="button">选择视频：</label>
					<label style="float: left;margin-left: -15px;" type="button" onclick="cleanHistory()">删除视频</label>
				</div>
				<div class="mui-input-row" style="width: auto;height: 3.5rem;">
					<ul id="history" class="dlist" style="text-align:left;height: 30px;">
						<li id="empty" class="ditem-empty">无视频</li>
					</ul>
				</div>
				<!-- <div id="outpos"/> -->
				<div id="output">
				</div>
			</form>
			<!-- 上传封面 -->
			<form class="mui-input-group">
			<div class="recommend-body">
				<div class="mui-input-row">
					<div class="recommend-img" id="loadphoto">
						<label>点我选择封面：</label>
					</div>
				</div>
				<div class="mui-input-row" style="width: auto;height: 10.5rem;">
					<div class="letter-photo" id="letter-photo">
						<div class="letter-photo-img">
							<img style="width: 6.5rem;height: 8.5rem;" src="./resource/css/images/iconfont-tianjia.png" data-preview-src="" data-preview-group="1" />
						</div>
					</div>
				</div>
			</div>
			</form>
			<!-- 上传多图片 -->
			<form class="mui-input-group">
			<div class="mui-input-row">
				<label>详情（点击图片）</label>
			</div>
				<input type="hidden" id="ckjl.id" name="ckjl.id" value="429">  
					<div class="collapse-content" >  
						<form>  
							<label class="row-label"></label>  
							<div id='F_CKJLBS' class="row image-list">  
							<div class="image-item " id="F_CKJLB" onclick="showActionSheet(this);"></div>  
					</div>  
						</form>  
				</div>
			 </form>
			 <!-- 封面的提交 不完善，不可点击-->
			 <div>
			 	<button id="sub" class="btn-recommend" style="margin-left: 45%;">提交</button>
			 </div>
	</div>
</body>
 <script src="./resource/mui.min.js"></script>
 <script type="text/javascript" charset="utf-8">
   	mui.init();
 </script>
 
 
<!--  ==============================分割线================================================ -->


<!-- 参数 -->
<script>
	var resourceid=null;
	var type1=null;
	var userInfo=window.localStorage.getItem(userInfo);
	var user=JSON.parse(userInfo);
	var uid=user.id;
	var username=user.userName;
	$(function(){
		$("#tree").hide();
		$("#Animal").hide();
		$("#land").hide();
		$("#output").hide();
	})
	$("#typed").change(function(){
		var typed=$("#typed option:selected").val();
		if(typed=="fruiter"){
			$("#tree").show();
			$("#Animal").hide();
			$("#land").hide();
		}else if(typed=="livestock"){
			$("#Animal").show();
			$("#tree").hide();
			$("#land").hide();
		}else if(typed=="plot"){
			$("#land").show();
			$("#tree").hide();
			$("#Animal").hide();
		}else{
			$("#land").hide();
			$("#tree").hide();
			$("#Animal").hide(); 
		}
	});
</script>





<!--  ==============================分割线================================================ -->


<!-- 图片上传 -->
<script>  
    var procinstid = 0;  
    //初始化页面执行操作  
    function plusReady() {  
        //Android返回键监听事件  
        plus.key.addEventListener('backbutton',function(){  
            myclose();  
        },false);  
    }  
    if (window.plus) {  
        plusReady();  
    } else {  
        document.addEventListener('plusready', plusReady, false);  
    }  
        //加载页面初始化需要加载的图片信息  
        //或者相册IMG_20160704_112620.jpg  
        //imgId:图片名称：1467602809090或者IMG_20160704_112620  
        //imgkey:字段例如：F_ZDDZZ  
        //ID：站点编号ID,例如429  
        //src：src="file:///storage/emulated/0/Android/data/io.dcloud.HBuilder/.HBuilder/apps/HBuilder/doc/upload/F_ZDDZZ-1467602809090.jpg"  
        function showImgDetail (imgId,imgkey,id,src) {    
            var html = "";  
            html +='<div  id="Img'+imgId+imgkey+'" class="image-item ">';   
            html +='    <img id="picBig" data-preview-src="" data-preview-group="1" '+src+'/>';  
            html +='    <span class="del" onclick="delImg(\''+imgId+'\',\''+imgkey+'\','+id+');">';         
            html +='        <div class="fa fa-times-circle"></div>';      
            html +='    </span>';   
            html +='</div>';  
            $("#"+imgkey+"S").append(html);  
        }  
        //删除图片  
        //imgId:图片名称：IMG_20160704_112614  
        //imgkey:字段，例如F_ZDDZZ  
        //ID：站点编号ID，例如429  
        function delImg(imgId,imgkey,id){  
            var bts = ["是", "否"];  
            plus.nativeUI.confirm("是否删除图片？", function(e) {  
                    var i = e.index;  
                    if (i == 0) {  
                        var itemname=id+"img-"+imgkey;//429img-F_ZDDZZ  
                        var itemvalue=plus.storage.getItem(itemname);  
                        //{IMG_20160704_112614,_doc/upload/F_ZDDZZ-IMG_20160704_112614.jpg,file:///storage/emulated/0/Android/data/io.dcloud...../doc/upload/F_ZDDZZ-1467602809090.jpg}  
                        if(itemvalue!=null){  
                            var index=itemvalue.indexOf(imgId+",");  
                            if(index==-1){//没有找到  
                                delImgfromint(imgId,imgkey,id,index);  
                            }else{   
                                delImgFromLocal(itemname,itemvalue,imgId,imgkey,index); //修改，加了一个index参数  
                            }  
                              
                        }else{  
                            delImgfromint(imgId,imgkey,id);   
                        }  
                    }  
                },"查勘", bts);  
            /*var isdel = confirm("是否删除图片？");  
            if(isdel == false){  
                return;  
            }*/  
              
              
        }  
        function delImgFromLocal(itemname,itemvalue,imgId,imgkey,index){  
                    var wa = plus.nativeUI.showWaiting();  
                    var left=itemvalue.substr(0,index-1);  
                    var right=itemvalue.substring(index,itemvalue.length);  
                    var end=right.indexOf("}");  
                    right=right.substring(end+1,right.length);  
                    var newitem=left+right;  
                    plus.storage.setItem(itemname,newitem);   
                    //myAlert("删除成功");  
                    $("#Img"+imgId+imgkey).remove();  
                    wa.close();  
        }  
        //选取图片的来源，拍照和相册  
        function showActionSheet(conf){  
              var divid = conf.id;  
              var actionbuttons=[{title:"拍照"},{title:"相册选取"}];  
              var actionstyle={title:"选择照片",cancel:"取消",buttons:actionbuttons};  
              plus.nativeUI.actionSheet(actionstyle, function(e){  
                    if(e.index==1){  
                        getImage(divid);  
                    }else if(e.index==2){  
                        galleryImg(divid);  
                    }  
              } );  
        }  
        function galleryImg(divid){
        		plus.gallery.pick( function(e){
        		//alert(e.files.length);
        		var zm=0;
        		setTimeout(file,200);
	    	    function file(){
	    	    	plus.io.resolveLocalFileSystemURL(e.files[zm], function(entry) {
					         compressImage(entry.toLocalURL(),entry.name,divid); 
				    }, function(e) {
					   plus.nativeUI.toast("读取拍照文件错误：" + e.message);
				    });
				    zm++;
				    if(zm<e.files.length){
				    	setTimeout(file,200);
				    }
	    	    }
    	         
                }, function ( e ) {
    	           console.log( "取消选择图片" );
                },{filename: "_doc/camera/",
                   filter:"image",
                   multiple:true,
				   maximum:15,
                });
         }
        // 拍照  
        function getImage(divid) {  
            var cmr = plus.camera.getCamera();  
            cmr.captureImage(function(p) {  
                //alert(p);//_doc/camera/1467602809090.jpg  
                plus.io.resolveLocalFileSystemURL(p, function(entry) {  
                    //alert(entry.toLocalURL());//file:///storage/emulated/0/Android/data/io.dcloud...../doc/camera/1467602809090.jpg  
                    //alert(entry.name);//1467602809090.jpg  
                    compressImage(entry.toLocalURL(),entry.name,divid);  
                }, function(e) {  
                    plus.nativeUI.toast("读取拍照文件错误：" + e.message);  
                });  
            }, function(e) {  
            }, {  
                filename: "_doc/camera/", 
                index: 1  
            });  
        }  
        //压缩图片  
        function compressImage(url,filename,divid){  
            var name="_doc/upload/"+divid+"-"+filename;//_doc/upload/F_ZDDZZ-1467602809090.jpg  
            plus.zip.compressImage({  
                    src:url,//src: (String 类型 )压缩转换原始图片的路径  
                    dst:name,//压缩转换目标图片的路径  
                    quality:20,//quality: (Number 类型 )压缩图片的质量.取值范围为1-100  
                    overwrite:true//overwrite: (Boolean 类型 )覆盖生成新文件  
                },  
                function(event) {   
                    //uploadf(event.target,divid);  
                    var path = name;//压缩转换目标图片的路径  
                    //event.target获取压缩转换后的图片url路  
                    //filename图片名称  
                    saveimage(event.target,divid,filename,path);  
                },function(error) {  
                    plus.nativeUI.toast("压缩图片失败，请稍候再试");  
            });  
        }  
        //保存信息到本地  
        /**  
         *   
         * @param {Object} url  图片的地址  
         * @param {Object} divid  字段的名称  
         * @param {Object} name   图片的名称  
         */  
        function saveimage(url,divid,name,path){  
            //alert(url);//file:///storage/emulated/0/Android/data/io.dcloud...../doc/upload/F_ZDDZZ-1467602809090.jpg  
            //alert(path);//_doc/upload/F_ZDDZZ-1467602809090.jpg  
            var  state=0;  
            var wt = plus.nativeUI.showWaiting();  
          //  plus.storage.clear();   
            name=name.substring(0,name.indexOf("."));//图片名称：1467602809090  
            var id = document.getElementById("ckjl.id").value;  
            var itemname=id+"img-"+divid;//429img-F_ZDDZ  
            var itemvalue=plus.storage.getItem(itemname);  
            if(itemvalue==null){  
                itemvalue="{"+name+","+path+","+url+"}";//{IMG_20160704_112614,_doc/upload/F_ZDDZZ-IMG_20160704_112614.jpg,file:///storage/emulated/0/Android/data/io.dcloud...../doc/upload/F_ZDDZZ-1467602809090.jpg}  
            }else{    
                itemvalue=itemvalue+"{"+name+","+path+","+url+"}";  
            }  
            plus.storage.setItem(itemname, itemvalue);  
              
            var src = 'src="'+url+'"';  
            //alert("itemvalue="+itemvalue);  
            showImgDetail(name,divid,id,src);  
            wt.close();  
              
        }  
        //上传图片，实例中没有添加上传按钮  
        function uploadimge(/* agree,back */) {  
        //plus.storage.clear();  
         var wa = plus.nativeUI.showWaiting();  
         var imgArray=[];  
         var id = document.getElementById("ckjl.id").value;   
         var length=id.toString().length;   
         var idnmae=id.toString();  
         var numKeys=plus.storage.getLength();  
         var task = plus.uploader.createUpload(commonJavaUrl+"Releaseresource/image_video", {  
                                method: "POST"  
                            },  
                            function(t, status) {  
                                if (status == 200) {  
										wa.close();  
										if(t.responseText){
											$("#F_CKJLBS").html('<div class="image-item " id="F_CKJLB" onclick="showActionSheet(this);"></div>');
											//封面图上传
											up2();
										}else{
											mui.toast('上传失败了！sorry，请重新来一遍',{ duration:"35000ms", type:'div' })
										}
                                } else {  
                                    wa.close();  
                                    console.log("上传失败");   
                                }  
                            }  
                        );  
			type1="2_"+resourceid+"/"+uid+"-"+username;
            task.addData("type1",type1); 
			 task.addData("resourceid",resourceid); 
           /* for(var i=0; i<imgArray.length;i++){    
                var itemkey=id+"img-F_CKJLB";//+imgArray[i];  
                if(plus.storage.getItem(itemkey)!=null){  
                    var itemvalue=plus.storage.getItem(itemkey).split("{");  
                    for(var img=1;img<itemvalue.length;img++){  
                        var imgname=itemvalue[img].substr(0,itemvalue[img].indexOf(","));  
                        var imgurl=itemvalue[img].substring(itemvalue[img].indexOf(",")+1,itemvalue[img].lastIndexOf(","));  
                        task.addFile(imgurl,{key:imgurl});  
                    }  
                }  
            } */ 
			 var itemkey=id+"img-F_CKJLB";//+imgArray[i];  
			 if(plus.storage.getItem(itemkey)!=null){
			     var itemvalue=plus.storage.getItem(itemkey).split("{"); 
			     for(var img=1;img<itemvalue.length;img++){  
			         var imgname=itemvalue[img].substr(0,itemvalue[img].indexOf(","));  
			         var imgurl=itemvalue[img].substring(itemvalue[img].indexOf(",")+1,itemvalue[img].lastIndexOf(","));
			         task.addFile(imgurl,{key:imgurl});
			     } 
				plus.storage.removeItem(itemkey); 
			 }
            task.start();  
        }
</script>  

<!--  ==============================分割线================================================ -->

<!-- 上传视频 -->
<script type="text/javascript">
		mui.init();
		var i=1,gentry=null,w=null;
		var hl=null,le=null,de=null,ie=null;
		var unv=true;
		var bUpdated=false; //用于兼容可能提前注入导致DOM未解析完更新的问题
		// H5 plus事件处理
		function plusReady(){
			// 获取摄像头目录对象
			plus.io.resolveLocalFileSystemURL('_doc/', function(entry){
				entry.getDirectory('camera', {create:true}, function(dir){
					gentry = dir;
					updateHistory();
				}, function(e){
					outSet('Get directory "camera" failed: '+e.message);
				} );
			}, function(e){
				outSet('Resolve "_doc/" failed: '+e.message);
			});
		}
		if(window.plus){
			plusReady();
		}else{
			document.addEventListener('plusready', plusReady, false);
		}
		// 监听DOMContentLoaded事件
		document.addEventListener('DOMContentLoaded', function(){
			// 获取DOM元素对象
			hl=document.getElementById('history');
			le=document.getElementById('empty');
			de=document.getElementById('display');
			if(ie=document.getElementById('index')){
				ie.onchange=indexChanged;
			}
			// 判断是否支持video标签
			unv=!document.createElement('video').canPlayType;
			updateHistory();
		},false );
		function changeIndex(){
			outSet('选择摄像头：');
			ie.focus();
		}
		function indexChanged(){
			de.innerText = ie.options[ie.selectedIndex].innerText;
			i = parseInt(ie.value);
			outLine(de.innerText);
		}
		
		// 显示文件
		function displayFile(li){
			if(w){
				outLine('重复点击！');
				return;
			}
			if(!li || !li.entry){
				ouSet('无效的媒体文件');
				return;
			}
			var name = li.entry.name;
			var suffix = name.substr(name.lastIndexOf('.'));
			var url = '';
			if(suffix=='.mov' || suffix=='.3gp' || suffix=='.mp4' || suffix=='.avi'){
				//if(unv){plus.runtime.openFile('_doc/camera/'+name);return;}
				url = '/camera_video.html';
			} else {
				url = '/camera_image.html';
			}
			w=plus.webview.create(url,url,{hardwareAccelerated:true,scrollIndicator:'none',scalable:true,bounce:'all'});
			w.addEventListener('loaded', function(){
				w.evalJS('loadMedia("'+li.entry.toLocalURL()+'")');
				//w.evalJS('loadMedia("'+'http://localhost:13131/_doc/camera/'+name+'")');
			}, false );
			w.addEventListener('close', function(){
				w = null;
			}, false);
			w.show('pop-in');
		}
		
		// 添加播放项
		function createItem(entry){
			cleanHistory();
			var li = document.createElement('li');
			li.className = 'ditem';
			li.innerHTML = '<span class="iplay"><font class="aname"></font><br/><font class="ainf"></font></span>';
			li.setAttribute('onclick', 'displayFile(this)' );
			hl.insertBefore( li, le.nextSibling );
			li.querySelector('.aname').innerText = entry.name;
			li.querySelector('.ainf').innerText = '...';
			li.entry = entry;
			updateInformation(li);
			// 设置空项不可见
			le.style.display = 'none';
		}
		// 获取录音文件信息
		function updateInformation(li){
			if(!li || !li.entry){
				return;
			}
			var entry = li.entry;
			entry.getMetadata(function(metadata){
				li.querySelector('.ainf').innerText = dateToStr(metadata.modificationTime);
			}, function(e){
				outLine('获取文件"'+entry.name+'"信息失败：'+e.message);
			} );
		}
		// 获取录音历史列表
		function updateHistory(){
			if(bUpdated||!gentry||!document.body){//兼容可能提前注入导致DOM未解析完更新的问题
				return;
			}
		  	var reader = gentry.createReader();
		  	reader.readEntries(function(entries){
		  		for(var i in entries){
		  			if(entries[i].isFile){
		  				/* createItem(entries[i]); */
		  			}
		  		}
		  	}, function(e){
		  		outLine('读取录音列表失败：'+e.message);
		  	});
		  	bUpdated = true;
		}
		// 清除历史记录
		function cleanHistory(){
			if(flag){
				hl.innerHTML = '<li id="empty" class="ditem-empty">无历史记录</li>';
				le = document.getElementById('empty');
				// 删除音频文件
				outSet('清空拍照录像历史记录：');
				gentry.removeRecursively(function(){
					// Success
					outLine('成功！');
				}, function(e){
					outLine('失败：'+e.message);
				});
				file=null;
			}
		}
				</script>
				
				
<script>
		mui.init();
		var file=null;
		var flag=false;
		document.getElementById('video').addEventListener('tap', function(){
		            if (mui.os.plus) { 
		                var a = [{ 
		                    title: "录像" 
		                }, { 
		                    title: "从手机相册选择" 
		                }]; 
		                plus.nativeUI.actionSheet({ 
		                    title: "上传视频", 
		                    cancel: "取消", 
		                    buttons: a 
		                }, function(b) { /*actionSheet 按钮点击事件*/ 
		                    switch (b.index) { 
		                        case 0: 
		                            break; 
		                        case 1: 
		                            getVideo(); /*录像*/ 
		                            break; 
		                        case 2: 
		                            galleryVideo();/*打开相册 找录像*/ 
		                            break; 
		                        default: 
		                            break; 
		                    } 
		                }) 
		            } 
		        }, false); 
		        /*这是打开录像的事件*/
		        function getVideo(){
		           	var cmr = plus.camera.getCamera();
		            var res = cmr.supportedVideoResolutions[0];//获取支持的分辨率，拿默认的第一个
		            var fmt = cmr.supportedVideoFormats[0];//获取支持的录像文件格式，拿默认的第一个
		            cmr.startVideoCapture( function( e ){//录像成功后会返回一个路径到e这里
		                    plus.io.resolveLocalFileSystemURL(e, function(entry){//这个是根据路径读取文件信息，其实这步可以省略。
							createItem(entry);
							flag=true;
							file=e;
		                        //uploadVideo(e);
		                    }, function(e){
		                        console.log("读取录像文件错误：" + e.message);
		                    });
		            },function( error ) {
		                    mui.toast("取消录制");
		                },
		                {resolution:res,format:fmt,videoMaximumDuration:30}
		            );
		      
			}
		
		        
		        function uploadVideo(){ 
		            //第二个参数一定要有，然后把文件路径扔进来
		            var task=plus.uploader.createUpload(commonJavaUrl+"Releaseresource/image_video", {  
                                method: "POST"  
                            },  
                            function(t, status) {  
                                if (status == 200) {  
									if(t.responseText){
										flag=true;
										cleanHistory();
										//详情上传
										uploadimge();
									}else{
										mui.toast('上传失败了！sorry，请重新来一遍',{ duration:"35000ms", type:'div' })
									}
                                } else {  
                                   mui.toast("上传失败了。sorry，请重新来一遍");  
                                }  
                            }  
                        );
					type1="1_"+resourceid+"/"+uid+"-"+username;
					task.addData("type1",type1);
		            task.addFile(file,{key:"file"});//这里是根据文件路径找到对应的文件,然后以file的参数名字扔给后台
		            task.start();//开始上传
		        }
		        
		        //本地相册选择 
		        function galleryVideo(){
		            // 从相册中选择图片
		            plus.gallery.pick( function(e){//打开相册后，回调的文件路径e
						plus.io.resolveLocalFileSystemURL(e, function(entry){//这个是根据路径读取文件信息，其实这步可以省略。
							createItem(entry);
							flag=true;
							file=e;
		                        //uploadVideo(e);
		                    }, function(e){
		                        console.log("读取文件错误：" + e.message);
		                    });
		            }, function ( e ) {
		                mui.toast( "您取消了选择视频" );
		            },{
		                filter: "video",//只打开视频，但是不知道为什么有其他选项
		                system: false//不用系统自带的打开相册功能
		            });
		        }
	</script>
	
	<!--   =======================================上传封面图 ======================== ======-->
	<!-- 上传封面图 -->
	<script type="text/javascript">
		mui.init();
		var photofile=null;
		var photo = document.getElementById('loadphoto')
	 
		//点击相机长传图片
		photo.addEventListener('tap', function() {
				var btnArray = [{
					title: "打开照相机"
				}, {
					title: "打开相册"
				}]; //选择按钮  1 2 3
				plus.nativeUI.actionSheet({
						title: "请选择",
						cancel: "取消", // 0
						buttons: btnArray
					},
					function(e) {
						var index = e.index; // 
						//alert(index);
						switch(index) {
							case 1:
								//写自己的逻辑
								camera();
								break;
							case 2:
								xiangce();
								break;
						}
					})
		})
	    
	    //调用相机
		function camera() {
			var cmr = plus.camera.getCamera();
			cmr.captureImage(function(p) {
				//成功
				plus.io.resolveLocalFileSystemURL(p, function(entry) {
					img_name = entry.name; //获得图片名称
					img_src = entry.toLocalURL(); //获得图片路径
					//var url1=document.getElementById('img');
					//url1.src=img_path;
					photofile=p;
	                //将图片渲染到页面
					var temp = '<div class="letter-photo-img">' +
						'<img src="' + img_src + '" class="load-img" data-preview-src="" data-preview-group="1">' +
						'</div>'
					$('#letter-photo').html(" ");
					$('#letter-photo').html(temp)
				}, function(e) {
					console.log("读取拍照文件错误：" + e.message);
				});
	 
			}, function(e) {
				console.log("失败：" + e.message);
			}, {
				filename: '_doc/camera/',
				index: 1
			});
		}
	 
	    //打开相册
		function xiangce() {
			plus.gallery.pick(function(path) {
				for(var i in path.files) {
					var fileSrc = path.files[i];
					photofile=path.files[i];
					var temp = ''
	                //渲染到页面
					temp = '<div class="letter-photo-img">' +
						'<img src="' + fileSrc + '" class="load-img" data-preview-src="" data-preview-group="1">' +
						'</div>'
					$('#letter-photo').html(" ");
					$('#letter-photo').html(temp)
				}
	 
			}, function(e) {
				console.log("取消选择图片");
			}, {
				filter: "image",
				multiple: true,
				maximum: 1,
				system: false,
				onmaxed: function() {
					plus.nativeUI.alert('最多只能选择6张图片');
				}
			});
		}
		function up2(){
			//第二个参数一定要有，然后把文件路径扔进来
            var task=plus.uploader.createUpload(commonJavaUrl+"Releaseresource/image_video", {  
						method: "POST" 
					},  
					function(t, status) { 
						if (status == 200) {  
							if(t.responseText){
								$('#letter-photo').html('<div class="letter-photo-img"><img style="width: 6.5rem;height: 8.5rem;" src="./resource/css/images/iconfont-tianjia.png" data-preview-src="" data-preview-group="1" /></div>');
								mui.back();
							}else{
								mui.toast('上传失败了！sorry，请重新来一遍',{ duration:"35000ms", type:'div' })
							}
						} else {
						   mui.toast("上传失败了。sorry，请重新来一遍");  
						}  
					}  
				);
			type1="3_"+resourceid+"/"+uid+"-"+username;
			task.addData("type1",type1);
            task.addFile(photofile,{key:"photofile"});//这里是根据文件路径找到对应的文件,然后以file的参数名字扔给后台
            task.start();//开始上传
		}	
	</script>
	
	
	<!-- 上传 -->
	<script>
		var sub = document.getElementById('sub')
		sub.addEventListener('tap', function() {
			var title=$("#title").val();
			var reTypeCode=$("#typed option:selected").val();
			if(username){
				if(reTypeCode=="fruiter"){
					mui.ajax(commonJavaUrl+"Releaseresource/resourceadd?"+$("#tree1").serialize(),{
					    dataType:"json",
					    type:"post",
					    data:{"title":title,"reTypeCode":reTypeCode,"uid":uid},
						timeout:10000,//超时时间设置为10秒；
					    success:function(data) {
							if(data){
								resourceid=data;
								//视频上传
								uploadVideo();
							}else{
								mui.toast('上传失败',{ duration:"35000ms", type:'div' })
							}
						}
					})
				}else if(reTypeCode=="livestock"){
					mui.ajax(commonJavaUrl+"Releaseresource/resourceadd?title="+title+"&reTypeCode="+reTypeCode+"&uid="+uid,{
					    dataType:"json",
					    type:"post",
					    data:$("#Animal1").serialize(),
						timeout:10000,//超时时间设置为10秒；
					    success:function(data) {
							if(data!=null){
								resourceid=data;
								//视频上传
								uploadVideo();
							}else{
								mui.toast('上传失败',{ duration:"35000ms", type:'div' })
							}
						},error:function(data){
							console.log(data);
						}
					})
				}else if(reTypeCode=="plot"){
					mui.ajax(commonJavaUrl+"Releaseresource/resourceadd?title="+title+"&reTypeCode="+reTypeCode+"&uid="+uid,{
					    dataType:"json",
					    type:"post",
					    data:$("#land1").serialize(),
						timeout:10000,//超时时间设置为10秒；
					    success:function(data) {
							if(data!=null){
								resourceid=data;
								//视频上传
								uploadVideo();
							}else{
								mui.toast('上传失败',{ duration:"35000ms", type:'div' })
							}
						},error:function(data){
							console.log(data);
						} 
					})
				}else{
					mui.toast('请选择描述！',{ duration:"35000ms", type:'div' })
					return;
				}
			}else{
				mui.toast('未登录！',{ duration:"35000ms", type:'div' })
			}
			
		}) 
	</script> 

</html>