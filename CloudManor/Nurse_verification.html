<!doctype html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="resource/mui/css/mui.css" rel="stylesheet" />
	</head>
<style>
		.item {
				   width: 30%;
				   height: 100px;
				   float: left;
				   position: relative;
				   margin: 10px 8% 5px 8%;
		}
		
		.addImg {
				   width: 140px;
				   height: 100px;
				   position: absolute;
				   left: 0;
				   top: 0;
				   z-index: 2;
				   cursor: pointer;
		}
		.preview,.preBlock{
				   position: absolute;
				   display: block;
				   width: 140px;
				   height: 100px;
				   left: 0;
				   top: 0;
		}
		.delete {
				   width: 25px;
				   position: absolute;
				   right: -30px;
				   top: -15px;
				   cursor: pointer;
				   display: none;
		}
		.preBlock img {
				   display: block;
				   width: 140px;
				   height: 100px;
		}
		.upload_input{
				   display: block;
				   width: 0;
				   height: 0;
				   -webkit-opacity: 0.0;
				   /* Netscape and Older than Firefox 0.9 */
				   -moz-opacity: 0.0;
				   /* Safari 1.x (pre WebKit!) 老式khtml内核的Safari浏览器*/
				   -khtml-opacity: 0.0;
				   /* IE9 + etc...modern browsers */
				   opacity: .0;
				   /* IE 4-9 */
				   filter:alpha(opacity=0);
				   /*This works in IE 8 & 9 too*/
				   -ms-filter:"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)";
				   /*IE4-IE9*/
				   filter:progid:DXImageTransform.Microsoft.Alpha(Opacity=0);
		}
	</style>
	
	<body>
		<script src="resource/jquery-3.2.1.js"></script> 
		<script src="resource/mui/js/mui.min.js"></script>
		<script src="resource/js/common.js"></script> 
		<script type="text/javascript">
			mui.init()
		</script>
		<header class="mui-bar mui-bar-nav">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
			<!-- <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a> -->
			<h1 class="mui-title">养护人身份验证</h1>
		</header>
		
		(<div class="mui-content">
			 <div style="margin-top: 5%;"></div> 
			 <input type="hidden" id="ckjl.id" name="ckjl.id" value="429">  
			        <div class="collapse-content" > 
					   <div>
					      <div>
					      	<span style="margin-left: 15%;font-size: 15px;color: #222222;">请拍摄或选取本人的二代身份证</span>					   
					      </div>
						  <div>
							  <span style="margin-left: 30%;font-size: 10px;color: #777777;">确保拍摄证件的清晰完整</span>
						  </div>
					   </div>
					</div>
		
		             <div class="item">
		             								<img class="icon addImg" onclick="clickImg(this);" src="resource/images/addImg.png"/>
		             								<input name="url" type="file" id="card1" class="upload_input" onchange="change(this)"/>
		             								<div class="preBlock">
		             									<img id="storeLogo" class="preview" alt="" name="pic" width="190" height="190"/>
		             								</div>
		             								<img class="delete" onclick="deleteImg(this)" src="resource/images/delete.png"/>
		             							</div>
		             <div class="item">
		             								<img class="icon addImg" onclick="clickImg(this);" src="resource/images/addImg.png"/>
		             								<input name="url" type="file" id="card2" class="upload_input" onchange="change(this)"/>
		             								<div class="preBlock">
		             									<img id="storeLogo1" class="preview" alt="" name="pic" width="190" height="190"/>
		             								</div>
		             								<img class="delete" onclick="deleteImg(this)" src="resource/images/delete.png"/>
		             							</div>
		             							
		             <div style="width:90%;float:left;margin:2% 5% 5% 5%;">
		             								
		             								<div style="width:30%;float:left;margin:1% 10% 1% 10%;font-size:10px;color:#808080;">
		             									身份证正面<span style="color: red;">(必填)</span>
		             								</div>
		             								<div style="width:30%;float:right;margin:1% 5% 1% 10%;font-size:10px;color:#808080;">
		             									身份证反面<span style="color: red;">(必填)</span>
		             								</div>
		             							</div>
		             <div class="item">
		             								<img class="icon addImg" onclick="clickImg(this);" src="resource/images/addImg.png"/>
		             								<input name="url" type="file" id="card3" class="upload_input" onchange="change(this)"/>
		             								<div class="preBlock">
		             									<img id="storeLogo1" class="preview" alt="" name="pic" width="190" height="190"/>
		             								</div>
		             								<img class="delete" onclick="deleteImg(this)" src="resource/images/delete.png"/>
		             							</div>
		             <div style="width:90%;float:left;margin:2% 5% 5% 5%;">
		             								
		             								<div style="width:30%;float:left;margin:1% 10% 1% 10%;font-size:10px;color:#808080;">
		             									手持身份证<span style="color: red;">(必填)</span>
		             								</div>
		             								
		             							</div>
		             
		             	     
				
		
		
		<div class="mui-content-padded" style="margin-top: 90%;">
		
		<p style="font-size: 0.7em;"><span style="color: red;">
		注</span>:&lt;&lt;身份信息务必真实&gt;&gt;确保信息的准确</p>
		</div>
		<button class="mui-btn mui-btn-block mui-btn-block bg_color_eb6100 btn-apply" style="background-color: #FF6600;color: white;" id="apply" onclick="submitImg()">提交审核</button>
		
		</div>
		
		
	</body>
	<script>
		//点击
		var clickImg = function(obj){
		    $(obj).parent().find('.upload_input').click();
		}
		//删除
		var deleteImg = function(obj){
		    $(obj).parent().find('input').val('');
		    $(obj).parent().find('img.preview').attr("src","");
		    //IE9以下
		    $(obj).parent().find('img.preview').css("filter","");
		    $(obj).hide();
		    $(obj).parent().find('.addImg').show();
		}
		//选择图片
		function change(file) {
		    //预览
		    var pic = $(file).parent().find(".preview");
		    //添加按钮
		    var addImg = $(file).parent().find(".addImg");
		    //删除按钮
		    var deleteImg = $(file).parent().find(".delete");
		
		    var ext=file.value.substring(file.value.lastIndexOf(".")+1).toLowerCase();
		
		    // gif在IE浏览器暂时无法显示
		    if(ext!='png'&&ext!='jpg'&&ext!='jpeg'){
		        if (ext != '') {
		            alert("图片的格式必须为png或者jpg或者jpeg格式！");
		        }
		        return;
		    }
		    //判断IE版本
		    var isIE = navigator.userAgent.match(/MSIE/)!= null,
		        isIE6 = navigator.userAgent.match(/MSIE 6.0/)!= null;
		    isIE10 = navigator.userAgent.match(/MSIE 10.0/)!= null;
		    if(isIE && !isIE10) {
		        file.select();
		        var reallocalpath = document.selection.createRange().text;
		        // IE6浏览器设置img的src为本地路径可以直接显示图片
		        if (isIE6) {
		            pic.attr("src",reallocalpath);
		        }else{
		            // 非IE6版本的IE由于安全问题直接设置img的src无法显示本地图片，但是可以通过滤镜来实现
		            pic.css("filter","progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod='scale',src=\"" + reallocalpath + "\")");
		            // 设置img的src为base64编码的透明图片 取消显示浏览器默认图片
		            pic.attr('src','data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==');
		        }
		        addImg.hide();
		        deleteImg.show();
		    }else {
		        html5Reader(file,pic,addImg,deleteImg);
		    }
		}
		//H5渲染
		function html5Reader(file,pic,addImg,deleteImg){
		    var file = file.files[0];
		    var reader = new FileReader();
		    reader.readAsDataURL(file);
		    reader.onload = function(e){
		        pic.attr("src",this.result);
		    }
		    addImg.hide();
		    deleteImg.show();
		}
		/* 使用二进制方式处理dataUrl */
		function processData(dataUrl) {
		    var binaryString = window.atob(dataUrl.split(',')[1]);
		    var arrayBuffer = new ArrayBuffer(binaryString.length);
		    var intArray = new Uint8Array(arrayBuffer);
		    for (var i = 0, j = binaryString.length; i < j; i++) {
		        intArray[i] = binaryString.charCodeAt(i);
		    }
		
		    var data = [intArray],
		        blob;
		
		    try {
		        blob = new Blob(data);
		    } catch (e) {
		        window.BlobBuilder = window.BlobBuilder ||
		            window.WebKitBlobBuilder ||
		            window.MozBlobBuilder ||
		            window.MSBlobBuilder;
		        if (e.name === 'TypeError' && window.BlobBuilder) {
		            var builder = new BlobBuilder();
		            builder.append(arrayBuffer);
		            blob = builder.getBlob(imgType); // imgType为上传文件类型，即 file.type
		        } else {
		            console.log('版本过低，不支持上传图片');
		        }
		    }
		    return blob;
		}
		
		function submitImg(){
		  
		    //1.获取图片的数据
		   
			var card1=document.getElementById("card1").files[0];
			var card2=document.getElementById("card2").files[0];
			var card3=document.getElementById("card3").files[0];
		    if (card1==undefined|card1==null|card2==undefined|card2==null|card3==undefined|card3==null){
		      /* location.href='cultivate_person_center.html' */
			   alert("资料填写不完整！")
		       return false;
			   
		    } 
			/* var user=localStorage.getItem("userInfo");
			userId=user.getId() */
			
		   /* 	var userInfo=window.localStorage.getItem(userInfo);
		   	var user=JSON.parse(userInfo);
			
		   	var userId=user.id;	 */
				
			//将获得的表单元素作为参数，对formData进行初始化
			var formdata=new FormData();
			formdata.append('cardzheng',card1);
			formdata.append('cardfan',card2);
			formdata.append('shouchi',card3);
		    formdata.append('userId',1)
			
		  $.ajax({
		        url:commonJavaUrl+"Authentication/NurseVerification",//在controller方法中如何接收图片数据
		        type:"post",
		        data:formdata,
		        processData: false,
		        contentType: false,
				dataType:"json",
		        success:function(data){
		            if(data){
		                alert("上传成功！");
						location.href='cultivate_person_center.html'
		            }else{
		                alert("上传失败！");
		            }
		        },fail:function(e){
		            alert("fail");
		        },
		        error:function(e){
		            alert("上传信息不全面");
		            console.log(e);
		        }
		
		    }); 
		}
	</script>
</html>
